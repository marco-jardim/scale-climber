var e,t,n=Object.getOwnPropertyNames,r=(e={"assets/PitchDetector.worker-BSdwUMKd.js"(e,t){let n=44100,r=1024,o=.15;function a(e){const t=e.length,n=Math.floor(t/2),r=new Float32Array(n);for(let o=0;o<n;o++){let t=0;for(let r=0;r<n;r++){const n=e[r]-e[r+o];t+=n*n}r[o]=t}return r}function s(e){const t=e.length,n=new Float32Array(t);n[0]=1;let r=0;for(let o=1;o<t;o++)r+=e[o],n[o]=e[o]/(r/o);return n}function l(e,t){const r=Math.floor(n/1e3),o=Math.floor(n/80);for(let n=r;n<o&&n<e.length;n++)if(e[n]<t){for(;n+1<e.length&&e[n+1]<e[n];)n++;return n}return-1}function i(e,t){if(0===t||t>=e.length-1)return t;const n=e[t-1],r=e[t],o=e[t+1];return t+(o-n)/(2*(2*r-o-n))}function f(e){const t=s(a(e)),r=l(t,o);if(-1===r)return{frequency:null,confidence:0,clarity:0};const f=i(t,r),c=n/f,u=1-t[Math.round(r)],h=t[Math.round(r)],d=t.reduce((e,t)=>e+t,0)/t.length,p=d>0?1-h/d:0;return{frequency:c,confidence:Math.max(0,Math.min(1,u)),clarity:Math.max(0,Math.min(1,p))}}self.onmessage=function(e){const{type:t,data:a}=e.data;switch(t){case"init":n=a.sampleRate||44100,r=a.bufferSize||1024,o=a.yinThreshold||.15,self.postMessage({type:"initialized",data:{sampleRate:n,bufferSize:r,yinThreshold:o}});break;case"process":{const{buffer:e,id:t}=a,n=function(e){let t=0;for(let r=0;r<e.length;r++)t+=e[r]*e[r];const n=Math.sqrt(t/e.length);return Math.min(10*n,1)}(e);let r;r=n<.01?{frequency:null,confidence:0,clarity:0,volume:n}:{...f(e),volume:n},self.postMessage({type:"result",id:t,data:r});break}case"update-config":a.sampleRate&&(n=a.sampleRate),a.bufferSize&&(r=a.bufferSize),void 0!==a.yinThreshold&&(o=a.yinThreshold),self.postMessage({type:"config-updated",data:{sampleRate:n,bufferSize:r,yinThreshold:o}});break;default:console.warn(`Unknown message type: ${t}`)}},void 0!==t&&t.exports&&(t.exports={detectPitch:f,differenceFunction:a,cumulativeMeanNormalizedDifference:s,absoluteThreshold:l,parabolicInterpolation:i})}},function(){return t||(0,e[n(e)[0]])((t={exports:{}}).exports,t),t.exports});export default r();
